/*
 * Reducer class for 
 * Project Name: Lab4
 * Group Name: what the f**k
 * Created: Wei Liu
 * Time: 2016/5/20 22:30
 */

import java.io.IOException;
import java.util.*;

import org.apache.hadoop.io.Text;
import org.apache.hadoop.mapreduce.Reducer;
import org.apache.hadoop.util.*;

public class StrongCheckReducer extends Reducer<Text, Text, Text, Text>
{

    public void reduce(Text key, Iterable<Text> values, Context context) throws IOException, InterruptedException
    {
	ArrayList<String> list =new ArrayList<String>();
	HashMap<String, Boolean> map =new HashMap<String, Boolean>();
			
	for(Text val : values)
	{
		String v=val.toString();
				
		if(v.startsWith("a"))
		{
			String v2=v.substring(1);
			map.put(v2);

		}
		else
		{
			list.add(v);
		}
	}

	for(int i=0;i<list.size();i++)
	{
		if(map.containsKey(list.get(i)))
		{
			if(outkey.toString().compareTo(list.get(i))<0)
                		context.write(outkey, new Text(list.get(i)));
            		else if(outkey.toString().compareTo(list.get(i))>0)
                		context.write(new Text(list.get(i)), outkey);
		}
	}

	boolean exist = false;
	for(Text val: values)
	{
	    if(val.toString().equals("&"))
		exist = true;
	    if(val.toString().equals("#") && exist)
        {
            String[] vertex = key.toString().split("#");
            if(vertex[0].compareTo(vertex[1])<0)
                context.write(new Text(vertex[0]), new Text(vertex[1]));
            else if(vertex[0].compareTo(vertex[1])>0)
                context.write(new Text(vertex[1]), new Text(vertex[0]));
        }

	}
    }

}
